'use strict';mix_d("BooksMultiEntitySimsCards__mes-dp:mes-dp__OirE47bv","exports tslib @c/aui-carousel @c/aui-truncate @c/browser-operations @c/remote-operations @c/scoped-dom @c/browser-window @c/logger @c/metrics".split(" "),function(C,h,J,K,L,M,N,O,P,Q){function l(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}var R=l(J),S=l(K),T=l(L),U=l(M),f=l(N),D=l(O),V=l(P),W=l(Q),w;(function(a){a.Series="series";a.Author="author"})(w||(w={}));var E;(function(a){a.AmazonCharts="AmazonCharts";
a.BestSellers="BestSellers";a.GiftGuide="GiftGuide";a.Preorder="Preorder";a.NewRelease="NewRelease"})(E||(E={}));var x;(function(a){a.selectTag="selectTag";a.logAsinClickMetrics="logAsinClickMetrics";a.logImpressionMetrics="logImpressionMetrics"})(x||(x={}));var y=x,z=function(a){a=a.getBoundingClientRect();return 0<a.height&&0<=a.top&&0<=a.left&&a.bottom<=D["default"].innerHeight&&a.right<=D["default"].innerWidth},r;(function(a){a.SELECT="SELECT";a.ASIN_CLICK="ASIN_CLICK";a.IMPRESSION="IMPRESSION"})(r||
(r={}));var A=function(){var a;var c=f["default"].cardRoot.querySelectorAll("div[data-asin]");var d=[];for(a=0;a<c.length;a++){var b=c[a];var e=b.getAttribute("data-asin");z(b)&&d.push(e)}var g=f["default"].cardRoot.querySelector('[id="cardContextDataContainer"]');c=g.getAttribute("data-page-asin");a=g.getAttribute("data-page-type");b=g.getAttribute("data-strategy-id");e=g.getAttribute("data-widget-group");g=g.getAttribute("data-user-agent");for(var m=f["default"].cardRoot.querySelectorAll('button[class*="tag"]'),
n=[],p=[],t=[],u=0;u<m.length;u++){var q=m[u],k=q.dataset.tagId;n.push(k);"true"===q.getAttribute("aria-checked")&&p.push(k);z(q)&&t.push(k)}return{asinsVisible:d,pageType:a,pageValue:c,selectedPills:p,strategyId:b,userAgent:g,visiblePills:t,widgetGroup:e}},B=function(a){try{W["default"].event(a,"books-mes","booksmes.metrics.frontend.1")}catch(c){V["default"].log("Error logging metrics: "+a+" "+c,"WARN")}},F=!1,G=function(a){return h.__awaiter(void 0,void 0,void 0,function(){var c,d;return h.__generator(this,
function(b){switch(b.label){case 0:return c=f["default"].cardRoot.querySelector("._mes-dp_styles_carouselContainer__1GXEo"),d=R["default"].getCarousel(c),[4,d.initialized];case 1:return b.sent(),[2]}})})},H=function(){var a=f["default"].cardRoot.querySelector('[class*="headerSection"]'),c=f["default"].cardRoot.querySelector("#cardContextDataContainer");if(!F&&z(a)){a=c.dataset.pageAsin;c=A();var d=f["default"].cardRoot.querySelectorAll("li[data-tag-id]");for(var b=new Map,e=0;e<d.length;e++){var g=
d[e],m=g.getAttribute("data-tag-id");g=g.getAttribute("data-asins");b.set(m,g)}d=JSON.stringify(Object.fromEntries(b));a=h.__assign(h.__assign({},c),{actionItem:a,actionType:r.IMPRESSION,widgetContent:d});B(a);F=!0}},Y=function(a,c){var d=X();a.setAttribute("aria-checked","true");a.classList.add(d);f["default"].cardRoot.querySelectorAll('button[class*="tag"]').forEach(function(b){b.dataset.tagId!==c&&(b.classList.remove(d),b.setAttribute("aria-checked","false"))})},aa=function(a,c){return h.__awaiter(void 0,
void 0,void 0,function(){var d,b,e,g,m,n,p;return h.__generator(this,function(t){switch(t.label){case 0:return Z(),d=f["default"].cardRoot.querySelector('li[data-tag-id="'+c+'"]'),b=d.dataset.tagType,e=d.dataset.asins.split(","),g=b===w.Series,m=b===w.Author,n=f["default"].cardRoot.querySelector("#cardContextDataContainer"),p="",g?p=n.getAttribute("data-series-asin"):m&&(p=n.getAttribute("data-author-asin")),[4,a.getCarouselData({asins:e,isForSeriesTag:g,isForAuthorTag:m,tagAsin:p}).then(function(u){return h.__awaiter(void 0,
void 0,void 0,function(){var q,k,I;return h.__generator(this,function(v){switch(v.label){case 0:q=n.getAttribute("data-selected-tag-id");if(c!==q)return[3,2];v=f["default"].cardRoot.querySelector("._mes-dp_styles_loadingText__2k3X_");f["default"].cardRoot.querySelector("._mes-dp_styles_carouselContainer__1GXEo").classList.remove("_mes-dp_styles_hidden__2eDsM");v.classList.remove("_mes-dp_styles_visible__1g8kr");n.setAttribute("data-selected-tag-type",b);k=f["default"].cardRoot.querySelector("._mes-dp_styles_carouselSection__1wy_z");
I=k.getAttribute("aria-label").split(":")[0];k.innerHTML="";k.appendChild(u);k.setAttribute("aria-label",I+":"+c);return[4,G()];case 1:v.sent(),S["default"].updateAll(),v.label=2;case 2:return[2]}})})})];case 1:return t.sent(),[2]}})})},Z=function(){var a=f["default"].cardRoot.querySelector("._mes-dp_styles_loadingText__2k3X_"),c=f["default"].cardRoot.querySelector("._mes-dp_styles_carouselContainer__1GXEo");a.style.height=c.offsetHeight+"px";c.classList.add("_mes-dp_styles_hidden__2eDsM");a.classList.add("_mes-dp_styles_visible__1g8kr")},
X=function(){return f["default"].cardRoot.querySelector('button[class*="tag"][aria-checked="true"]').classList.value.split(" ").find(function(a){return a.includes("selected")})};C._operationNames=["getCarouselData"];C.card=function(){return h.__awaiter(void 0,void 0,void 0,function(){var a,c;return h.__generator(this,function(d){switch(d.label){case 0:return H(),a=U["default"].setup(),c=T["default"].setup().define,[4,G()];case 1:return d.sent(),c(y.selectTag,"click",function(b){var e=b.currentTarget;
b=e.dataset.tagId;"true"!==e.getAttribute("aria-checked")&&(f["default"].cardRoot.querySelector("#cardContextDataContainer").setAttribute("data-selected-tag-id",b),Y(e,b),e=A(),e=h.__assign(h.__assign({},e),{actionItem:b,actionType:r.SELECT,widgetContent:""}),B(e),aa(a,b))}),c(y.logAsinClickMetrics,"click",function(b){b=b.currentTarget.id;var e=A();b=h.__assign(h.__assign({},e),{actionItem:b,actionType:r.ASIN_CLICK,widgetContent:""});B(b)}),c(y.logImpressionMetrics,"scroll",function(b){H()}),[2]}})})}});
